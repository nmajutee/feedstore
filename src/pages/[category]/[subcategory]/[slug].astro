---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import { products, categories } from '../../../data/products';

export function getStaticPaths() {
  return products.map(product => ({
    params: {
      category: product.topCategory,
      subcategory: product.subCategory,
      slug: product.slug
    },
    props: { product },
  }));
}

const { product } = Astro.props;

// Find category and subcategory names for breadcrumbs
const category = categories.find(c => c.slug === product.topCategory);
const subCategory = category?.subCategories.find(s => s.slug === product.subCategory);
---

<Layout title={`${product.name} - AgroPro`}>
   <div class="full_bg">
      <Header />
   </div>

   <div class="about">
      <div class="container">
         <!-- Breadcrumbs -->
         <div class="row">
            <div class="col-md-12">
                <nav aria-label="breadcrumb" style="margin-top: 20px; margin-bottom: 20px;">
                    <ol class="breadcrumb" style="background: transparent; padding-left: 0;">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item"><a href={`/${category?.slug}`}>{category?.name}</a></li>
                        <li class="breadcrumb-item"><a href={`/${category?.slug}/${subCategory?.slug}`}>{subCategory?.name}</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{product.name}</li>
                    </ol>
                </nav>
            </div>
         </div>

         <div class="row">
            <div class="col-md-12">
               <div class="titlepage text_align_center">
                  <h2>{product.name}</h2>
               </div>
            </div>
         </div>

         <div class="row">
            <div class="col-md-6">
               <div class="about_img">
                  <figure><img src={product.image} alt={product.name} style="width: 100%; max-height: 400px; object-fit: contain;"/></figure>
               </div>

               <div style="margin-top: 30px; background: #f9f9f9; padding: 20px; border-radius: 5px;">
                  <h3>Product Specifications</h3>
                  <table class="table table-striped">
                      <tbody>
                          <tr>
                              <th>Price</th>
                              <td style="font-weight: bold; color: #264653;">${product.price.toFixed(2)} / {product.weight}</td>
                          </tr>
                          <tr>
                              <th>Min Quantity</th>
                              <td>{product.minQuantity || product.weight}</td>
                          </tr>
                          <tr>
                              <th>Animal</th>
                              <td>{product.animal}</td>
                          </tr>
                          <tr>
                              <th>Life Stage</th>
                              <td>{product.lifeStage}</td>
                          </tr>
                          <tr>
                              <th>Protein</th>
                              <td>{product.protein}</td>
                          </tr>
                          {product.energy && (
                          <tr>
                              <th>Energy</th>
                              <td>{product.energy}</td>
                          </tr>
                          )}
                          <tr>
                              <th>Packaging</th>
                              <td>{product.packaging.join(', ')}</td>
                          </tr>
                      </tbody>
                  </table>
               </div>
            </div>

            <div class="col-md-6">
               <div class="about_text">
                  <h3>Description</h3>
                  <p>{product.description}</p>
                  <p>{product.details}</p>

                  {product.benefits && product.benefits.length > 0 && (
                      <div style="margin-top: 20px;">
                          <h4>Key Benefits</h4>
                          <ul>
                              {product.benefits.map(benefit => (
                                  <li style="list-style-type: disc; margin-left: 20px;">{benefit}</li>
                              ))}
                          </ul>
                      </div>
                  )}

                  {product.feedingRate && (
                      <div style="margin-top: 20px;">
                          <h4>Feeding Rate</h4>
                          <p>{product.feedingRate}</p>
                      </div>
                  )}

                  {product.ingredients && (
                      <div style="margin-top: 20px;">
                          <h4>Ingredients</h4>
                          <p style="font-size: 0.9em; color: #666;">{product.ingredients}</p>
                      </div>
                  )}
               </div>

               <!-- Inquiry Button -->
               <div class="contact" style="margin-top: 40px; padding: 0;">
                   <div class="titlepage text_align_left">
                       <h3>Interested in this product?</h3>
                   </div>
                   <button class="send_btn" onclick={`openEnquiryModal('${product.name.replace(/'/g, "\\'")}')`}>Send Enquiry</button>
               </div>

            </div>
         </div>

         {product.longDescription && (
            <div class="row" style="margin-top: 60px;">
               <div class="col-md-12">
                  <div class="titlepage text_align_left">
                     <h3>Detailed Description</h3>
                  </div>
                  <div class="long-description" style="line-height: 1.8; color: #555;" set:html={product.longDescription} />
               </div>
            </div>
         )}

         {product.feedingGuide && (
            <div class="row" style="margin-top: 40px;">
               <div class="col-md-12">
                  <div class="titlepage text_align_left">
                     <h3>Feeding Guide</h3>
                  </div>
                  <div class="feeding-guide" style="background: #f8f9fa; padding: 30px; border-radius: 10px; border-left: 5px solid #e9c46a;" set:html={product.feedingGuide} />
               </div>
            </div>
         )}

         {product.faqs && product.faqs.length > 0 && (
            <div class="row" style="margin-top: 40px; margin-bottom: 60px;">
               <div class="col-md-12">
                  <div class="titlepage text_align_left">
                     <h3>Frequently Asked Questions</h3>
                  </div>
                  <div class="accordion" id="productFaqAccordion">
                     {product.faqs.map((faq, index) => (
                        <div class="card" style="margin-bottom: 10px; border: 1px solid #eee; border-radius: 5px; overflow: hidden;">
                           <div class="card-header" id={`heading${index}`} style="background: #fff; padding: 0; border-bottom: none;">
                              <h5 class="mb-0">
                                 <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target={`#collapse${index}`} aria-expanded="false" aria-controls={`collapse${index}`} style="color: #264653; font-weight: bold; text-decoration: none; padding: 20px; width: 100%; text-align: left; display: flex; justify-content: space-between; align-items: center; background: #fff; border: none; box-shadow: none;">
                                    {faq.question}
                                    <span style="font-size: 1.5em; line-height: 0.5;">+</span>
                                 </button>
                              </h5>
                           </div>
                           <div id={`collapse${index}`} class="collapse" aria-labelledby={`heading${index}`} data-parent="#productFaqAccordion">
                              <div class="card-body" style="color: #666; line-height: 1.6; padding: 0 20px 20px 20px; border-top: none;">
                                 {faq.answer}
                              </div>
                           </div>
                        </div>
                     ))}
                  </div>
               </div>
            </div>
         )}

      </div>
   </div>

   <Footer />
</Layout>
